<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="/WF/Scripts/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="/WF/Scripts/bootstrap/css/font-awesome.css" rel="stylesheet">
    <link href="/WF/Style/skin/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/WF/Style/skin/css/animate.css" rel="stylesheet" type="text/css" />
    <link href="/WF/Style/skin/font/iconfont.css" rel="stylesheet" type="text/css" />
    <!--通用js-->
    <script src="/WF/Scripts/jquery-1.11.0.min.js" type="text/javascript"></script>
    <script src="/WF/Scripts/QueryString.js" type="text/javascript"></script>
    <script src="/WF/Scripts/config.js" type="text/javascript"></script>
    <script src="/WF/Comm/Gener.js" type="text/javascript"></script>
    <link href="css/icons.css" rel="stylesheet" />
    <script type="text/javascript">
        var workID = GetQueryString("WorkID"); //workid 子线程的ID
        $(function () {

            var webUser = new WebUser();
            //传入数据调用ajax. 返回查询犯人的接口.
            var data = "";
            var jianqus = new Entities("BP.JianYu.JianQus");

            //判断登录人部门，刑罚科：确认职务犯，各监区：确认各监区非职务犯
            var isZWF = 0;//默认非职务犯
            //行政刑罚科时，确认职务犯
            if (webUser.FK_DeptName.indexOf('刑罚') >= 0) {
                isZWF = 1;
                jianqus.RetrieveAll();
            } else {
                jianqus.Retrieve("No", webUser.FK_Dept);
            }

            //查询犯人.
            var ens = new Entities("BP.JianYu.Fanrens");
            if (isZWF == 1)
                ens.Retrieve("WorkIDOf001", workID, "zwf", isZWF, "DelFlag", 0);
            else
                ens.Retrieve("WorkIDOf001", workID, "JianQuNo", webUser.FK_Dept, "zwf", isZWF, "DelFlag", 0);


            var html = "<table class='table table-bordered table - hover' >";

            if (isZWF == 1)
                html += "<caption>您好：" + webUser.No + webUser.Name + "来自:" + webUser.FK_DeptName + "; 本次本监区职务犯分到的指标数:XXX名，本次本监区职务犯上报人数职务犯:" + ens.length + "名。</capiton>";
            else
                html += "<caption>您好：" + webUser.No + webUser.Name + "来自:" + webUser.FK_DeptName + "；本次本监区非职务犯分到的指标数:XXX名，本次本监区非职务犯上报人数非职务犯:" + ens.length + "名。</capiton>";

            html += "<tr>";
            html += "<th>编号</th>";
            html += "<th>姓名</th>";
            html += "<th>年龄</th>";
            html += "<th>监区</th>"; //监区
            html += "<th>分监区</th>"; //分监区
            html += "<th>入监日期</th>";
            html += "<th>罪名</th>";
            html += "<th>罪犯类型</th>";
            html += "<th>罪犯类别</th>";
            html += "<th>原判刑期</th>";
            html += "<th>现刑期</th>";
            html += "<th>减刑间隔</th>";
            html += "<th>减刑幅度</th>";
            html += "<th>表扬次数</th>";
            html += "<th>年累计分</th>";
            html += "<th>是否老病残</th>";
            html += "<th>是否立功</th>";
            html += "<th>是否重大立功</th>";
            html += "<th>操作</th>";   //分监区
            html += "</tr>";

            for (var idx = 0; idx < jianqus.length; idx++) {
                var jq = jianqus[idx];

                html += "<tr>";
                html += "<th colsapn=5>" + jq.No + " - " + jq.Name + "</th>";
                html += "</tr>";

                for (var i = 0; i < ens.length; i++) {

                    var en = ens[i];
                    if (en.JianQuNo != jq.No)
                        continue;

                    html += "<tr>";

                    html += "<td>" + en.MyPK + "</td>";
                    html += "<td>" + en.Name + "</td>";
                    html += "<td>" + en.Age + "</td>";
                    html += "<td>" + en.JianQuNo + en.JianQuNoText + "</td>"; //监区
                    html += "<td>" + en.FenJianQuNo + en.FenJianQuNoText + "</td>"; //分监区

                    html += "<td>" + en.DTComein + "</td>";
                    html += "<td>" + en.ZuiMing + "</td>";
                    html += "<td>" + en.ZuiFanLX + "</td>";
                    html += "<td>" + en.ZuiFanLB + "</td>";
                    html += "<td>" + en.YuanPanXQ + "</td>";
                    html += "<td>" + en.XianXQ + "</td>";
                    html += "<td>" + en.JianXingJG + "</td>";
                    html += "<td>" + en.JianXingFD + "</td>";
                    html += "<td>" + en.BiaoYangCS + "</td>";
                    html += "<td>" + en.NianLeiJF + "</td>";
                    if (en.ShiFouLBC == 0) {
                        html += "<td>否</td>";
                    } else {
                        html += "<td>是</td>";
                    }
                    if (en.ShiFouLG == 0) {
                        html += "<td>否</td>";
                    } else {
                        html += "<td>是</td>";
                    }
                    if (en.ShiFouZDLG == 0) {
                        html += "<td>否</td>";
                    } else {
                        html += "<td>是</td>";
                    }
                   // html += "<td><a href=\"javascript:Update('" + en.MyPK + "')\" >修改</a>|<a href=\"javascript:Del('" + en.MyPK + "')\" >删除</a></td>"; //分监区

                    html += "</tr>";
                }
            }
            html += "</table>";
            $("#docs").html(html);

            ////console.log(html);
            //var handler = new HttpHandler("BP.JianYu.AppHandler");
            //handler.AddPara("Ens", data);

        });

        //保存查询结果.
        function Del(id) {
            var en = new Entity("BP.JianYu.Fanren", id);
            en.Delete();
            window.location.href = window.location.href;
        }
        //修改
        function Update(id) {
            var url = "/WF/Comm/En.htm?EnName=BP.JianYu.Fanren&PKVal=" + id;
            WinOpen(url);
        }
        //保存查询结果.
        function AddNew() {

            var webUser = new WebUser();
            var name = window.prompt('请输入编号', "001");

            var en = new Entity("BP.JianYu.Fanren");
            en.FenJianQuNo = webUser.FK_Dept;
            en.MyPK = workID + name;
            en.Name = name;
            en.WorkIDOfSubthread = workID;
            en.WorkIDOf001 = fid;
            en.Insert();

            window.location.href = window.location.href;
        }

        //执行发送到下一步.
        function SendIt() {

            if (window.confirm('确定要发送吗？') == false)
                return;

            $("#toolbar").html("正在发送请稍后.");

            var handler = new HttpHandler("BP.JianYu.AppHandler");
            handler.AddUrlData();
            var data = handler.DoMethodReturnString("ND102_SendIt");
            $("#docs").html(data);
        }

        function Chart() {
            var url = "/WF/WorkOpt/OneWork/Chart.htm?WorkID=" + GetQueryString("WorkID") + "&FK_Node=" + GetQueryString("FK_Node");
            url += "&FID=" + GetQueryString("FID") + "&FK_Flow=001";
            WinOpen(url);
        }
    </script>
</head>
<body>
    <div id="docs">
    </div>

</body>
</html>
