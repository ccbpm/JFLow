<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
     <title>节点-事件</title>
    <link href="../../Scripts/easyUI/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    <link href="../../Scripts/easyUI/themes/icon.css" rel="stylesheet" type="text/css" />
    <script src="../../Scripts/easyUI/jquery-1.8.0.min.js" type="text/javascript"></script>
    <script src="../../Scripts/easyUI/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../../Scripts/QueryString.js" type="text/javascript"></script>

    <script language="JavaScript" src="../../Comm/JScript.js" type="text/javascript" ></script>
    <script type="text/javascript" src="../../Scripts/bootstrap/js/jquery.min.js"></script>
    <script src="../../Scripts/QueryString.js" type="text/javascript"></script>
    <link href="../../../DataUser/Style/ccbpm.css" rel="stylesheet"  type="text/css" />

    <!-- 引用通用的js文件. -->
    <script type="text/javascript" src="../../Scripts/config.js"></script>
    <script type="text/javascript" src="../../Comm/Gener.js"></script>
     

    <script type="text/javascript">
        //页面启动函数.
        $(function () {

            $("#Msg").html("正在加载,请稍后......");

            //初始化groupID.
            var nodeID = GetQueryString("FK_Node");

            var ens = new Entities("BP.Sys.FrmEvents");
            ens.Retrieve("FK_Node", nodeID);

            var html = "<table style='width:90%;'>";
            html += "<caption>节点事件 - <a href='javascript:New()'>新建节点事件</a></caption>";
            html += "<tr>";
            html += "<th>事件</th>";
            html += "<th>类型</th>";
            html += "<th>内容</th>";
            html += "<th>操作</th>";
            html += "</tr>";

            for (var i = 0; i < ens.length; i++) {

                var en = ens[i];

                html += "<tr>";
                html += "<td>" + en.FK_Event + "</td>";
                html += "<td>" +GetDoType( en.EventDoType) + "</td>";
                html += "<td>" + en.DoDoc + "</td>";
                html += "<td><a href=\"javascript:Delete('" + en.MyPK + "')\"><img src='/WF/Img/Btn/Delete.gif' border=0 />删除</a></td>";
                html += "</tr>";
            }
            html += "</table>";

            $("#Msg").html(html);
            return;

            //事件类型.
            var eventLists = [

            { No: "WorkArrive", Name: "工作到达", IsHaveMsg: 1, Note: '到达当前的工作的时候.' },
            { No: "SendWhen", Name: "当节点发送前", IsHaveMsg: 0, Note: '发送前事件，可以抛出异常阻止流程向下发送.' },
            { No: "SendSuccess", Name: "节点发送成功时", IsHaveMsg: 1, Note: '成功的事件.' },
            { No: "SendError", Name: "节点发送失败时", IsHaveMsg: 0, Note: '失败后的处理业务.' },
            { No: "ReturnBefore", Name: "当节点退回前", IsHaveMsg: 0, Note: '退回前的业务逻辑，可以抛出异常阻止退回.' },
            { No: "ReturnAfter", Name: "当节点退回后", IsHaveMsg: 1, Note: '退回后的业务逻辑.' },
            { No: "UndoneBefore", Name: "当节点撤销发送前", IsHaveMsg: 0, Note: '可以抛出异常阻止撤销动作.' },
            { No: "UndoneAfter", Name: "当节点撤销发送后", IsHaveMsg: 1, Note: '.' },
            { No: "WhenReadWork", Name: "工作打开后", IsHaveMsg: 0, Note: '打开工作的时候，就是接受人阅读的时候.' }
            ]

            var html = "<div title='sss' style='padding:10px; overflow:auto' data-options=''>";

            html += "<ul class='navlist' >";
            for (i = 0; i < eventLists.length; i++) {

                var eventList = eventLists[i];
                var msg = "";
                if (eventList.IsHaveMsg == 1)
                    msg = "<img src='../../Img/Msg.png' />";
                //   alert(JSON.stringify(eventList));
                if (event == eventList.No)
                    html += "<li title='" + (eventList.Note || "") + "'><a target='_self' href='Action.htm?FK_Node=" + nodeID + "&FK_Flow=" + flowNo + "&Event=" + eventList.No + "' ><b>" + eventList.Name + msg + "</b></a></li>";
                else
                    html += "<li title='" + (eventList.Note || "") + "'><a target='_self' href='Action.htm?FK_Node=" + nodeID + "&FK_Flow=" + flowNo + "&Event=" + eventList.No + "' >" + eventList.Name + msg + "</a></li>";
            }

            html += "</ul>";
            html += "</div>";

            var div = document.getElementById("left");
            div.innerHTML = html;

        });

        function New() {
            var url = "ActionDtl.htm?FK_Node=" + GetQueryString("FK_Node");
            window.location.href = url;
        }

        function Delete(mypk) {

            if (confirm('您确定要删除吗？') == false)
                return;

            var handler = new HttpHandler("BP.WF.HttpHandler.WF_Admin_AttrNode");
            handler.AddUrlData();
            handler.AddFormData();
            handler.AddPara("MyPK", mypk);

            var data = handler.DoMethodReturnString("ActionDtl_Delete");
            if (data.indexOf('err@') >= 0) {
                alert(data);
                return;
            }
            window.location.href = window.location.href;
            return;
        }

        function GetDoType(doType) {

            var cfg = "@0=禁用@1=执行存储过程@2=执行SQL语句@3=执行URL@4=WebServices(未完成)@5=执行ddl文件的类与方法@6=EventBase类@7=业务单元";

            var cfgs = cfg.split('@');

            for (var i = 0; i < cfgs.length; i++) {
                var vss = cfgs[i];
                if (vss.indexOf('=') == -1)
                    continue;
                var vals = vss.split('=');
                if (vals[0] == doType)
                    return vals[1];
            }
            return doType + 'ss';
        }
    </script>
</head>
<body  >
	<form id="cc">
	 
     <div id="Msg"></div>

	</form>
</body>
</html>
