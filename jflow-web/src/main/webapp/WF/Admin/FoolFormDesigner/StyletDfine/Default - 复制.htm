<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>样式定义工具</title>
    <script src="../../../Scripts/jquery-1.11.0.min.js"></script>
    <script src="../../../Scripts/QueryString.js" type="text/javascript"></script>
    <script src="../../../Scripts/config.js" type="text/javascript"></script>
    <script src="../../../Scripts/QueryString.js" type="text/javascript"></script>
    <script src="../../../Comm/Gener.js" type="text/javascript"></script>
    <script src="../../../Comm/jquery.js"></script>
    <script src="../../../Comm/jquery.colorpicker.js"></script>
    <link href="../../../../DataUser/Style/FoolFrm.css" rel="stylesheet" />
    <link href="../../../Scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <script type="text/javascript">

        //获得集合.
        var ens = null;
        var en = null;
        $(function () {

            var hander = new HttpHandler("BP.WF.HttpHandler.WF_Admin_FoolFormDesigner_StyletDfine");
            ens = hander.DoMethodReturnJSON("Default_Init");


            //ens = new Entities("BP.Sys.GloVars");
            //ens.Retrieve("GroupKey", "FoolFrmStyle", "Idx");
            //if (ens.length == 0) {
            //    //如果没有数据，就让其初始化.
            //    ens.DoMethodReturnString("FoolFrmStyle_Init");
            //    //查询出来.
            //    ens.Retrieve("GroupKey", "FoolFrmStyle");
            //}

            //绑定下拉框.
            GenerBindDDL("DDL_Style", ens, "No", "Name");


            var idx = GetQueryString("Idx");
            if (idx == null || idx == undefined)
                idx = 1;

            $("#DDL_Style ").get(0).selectedIndex = idx;

            //$("#styleeditor").hide();

            //$(".FoolFrmBody").on("click", function () {
            //    DDLChange("FoolFrmBody");
            //})

            //$(".FoolFrmTable").on("click", function () {
            //    DDLChange("FoolFrmTable");
            //})

            //$(".FoolFrmFieldName").on("click", function () {
            //    DDLChange("FoolFrmFieldName");
            //})

        });


        function DDLChange(val) {

            //显示.
            $("#styleeditor").show();

            //保存条目.
            SaveItem();

            //获得值.
            if (val == undefined) {
                val = $("#DDL_Style").val();
            } else {
                var myval = $("#DDL_Style").val();
                if (myval == val)
                    return;
                $("#DDL_Style").val(val);
            }

            if (val == null || val == "" || val == undefined) {
                $("#styleeditor").hide();
                return;
            }


            //if (val == undefined) {
            //    val = $("#DDL_Style").val();
            //} else {
            //    var myval = $("#DDL_Style").val();
            //    if (myval == val)
            //        return;
            //    $("#DDL_Style").val(val);
            //}

            for (var i = 0; i < ens.length; i++) {
                var enJson = ens[i];
                if (enJson.No != val)
                    continue;

                en = new Entity("BP.Sys.GloVar", enJson.No);
                en.AtPara = enJson.AtPara;


                //执行批量赋值.
                var val = en.Val;
                en.AtPara = val;

                GenerFullAllCtrlsVal(en);

                //alert("设置成功");

            }
        }

        //保存应用.
        function SaveItem() {

            if (en == null) {
                //alert('保存错误:没有选择样式.');
                return;
            }

            $("#Btn_SaveItem").val("正在保存...");

            //执行copy.
            en.CopyForm();
            en.Val = en.AtPara;
            en.Update();

            $("#Btn_SaveItem").val("保存成功....");

            setTimeout(function () { SetLab(); }, 1000);
            //   alert("保存成功..");
        }

        function SetLab() {
            $("#Btn_SaveItem").val("保存");
        }



        function Back() {

            var url = "../Designer.htm?FK_MapData=" + GetQueryString("FrmID");
            url += "&FrmID=" + GetQueryString("FrmID");
            url += "&FK_Flow=" + GetQueryString("FK_Flow");
            url += "&FK_Node=" + GetQueryString("FK_Node");
            window.location.href = url;
        }

        function Save() {

            if (window.confirm('您确认要执行吗？确定后，就会替换现在的风格文件。') == false)
                return;

            ////执行保存所有.
            //for (var i = 0; i < ens.length; i++) {
            //    var enJson = ens[i];
            //    if (enJson.No != val)
            //        continue;
            //    en = new Entity("BP.Sys.GloVar", enJson);
            //    en.Update();
            //}

            var hander = new HttpHandler("BP.WF.HttpHandler.WF_Admin_FoolFormDesigner_StyletDfine");
            var data = hander.DoMethodReturnString("Default_App");

            if (data.indexOf('err@') == 0) {
                alert(data);
                return;
            }

            // alert(data);

            Back();
        }
        function SaveAsTemplate() {

            var str = window.prompt("请输入模版名称,不能有特殊符号.", "");
            if (str == null || str == undefined || str == "")
                return;

            var hander = new HttpHandler("BP.WF.HttpHandler.WF_Admin_FoolFormDesigner_StyletDfine");
            hander.AddPara("TemplateName",str);
            var data = hander.DoMethodReturnString("Default_SaveAsTemplate");

            if (data.indexOf('err@') == 0) {
                alert(data);
                return;
            }

            alert(data);
        }
        function LoadTemplate() {

            var url = "Template.htm?FK_MapData=" + GetQueryString("FrmID");
            url += "&FrmID=" + GetQueryString("FrmID");
            url += "&FK_Flow=" + GetQueryString("FK_Flow");
            url += "&FK_Node=" + GetQueryString("FK_Node");

            window.location.href = url;
        }
    </script>
</head>
<body>

    <div style="width:90%; height:100%;margin:0 auto;">

        <div class="FoolHeader">
            <span>风格定义beta 1.0 </span>
            <input type="button" class="form-control-plaintext btn btn-outline-primary btn-sm toprightbutton" value="返回" onclick="Back();" />
            <input type="button" class="btn btn-outline-primary btn-sm toprightbutton" value="应用" onclick="Save();" />

            <input type="button" class="btn btn-outline-primary btn-sm toprightbutton" value="保存为模版" onclick="SaveAsTemplate();" />
            <input type="button" class="btn btn-outline-primary btn-sm toprightbutton" value="模版" onclick="LoadTemplate();">
        </div>


        <div class="FoolFrmBody" style="width:80%;">
            <!--  表单头部   -->
            <div class="FoolFrmTable" style="box-shadow: 5px 7px 5px #eaeaea;">

                <div class="FoolFrmTitleTH" onclick="DDLChange('FoolFrmTitleTH')">
                    <img class="FoolFrmTitleIcon" onclick="DDLChange('FoolFrmTitleIcon')" src="/DataUser/ICON/LogBiger.png" />
                    <span class="FoolFrmTitleLable" onclick="DDLChange('FoolFrmTitleLable')">请假申请单</span>
                </div>
                <div style="float:left;width: 100%;height: 40px;">
                    <span class="FoolFrmGroupBar" onclick="DDLChange('FoolFrmGroupBar')">基本信息</span>
                </div>
                <div class="FoolFrmFieldTR">
                    <span class="FoolFrmFieldName input-group-text" onclick="DDLChange('FoolFrmFieldName')">申请人</span>
                    <input class="FoolFrmFieldCtrl form-control" style="width:20%;float:left;" onclick="DDLChange('FoolFrmFieldCtrl')" type="text" />
                    <span class="FoolFrmFieldName input-group-text" style="margin-left:9%;" onclick="DDLChange('FoolFrmFieldName')">申请日期</span>
                    <input class="FoolFrmFieldCtrl form-control" style="width:20%;float:left;" onclick="DDLChange('FoolFrmFieldCtrl')" type="text" />
                    <span class="FoolFrmFieldName input-group-text" style="margin-left:9%;" onclick="DDLChange('FoolFrmFieldName')">申请人部门</span>
                    <input class="FoolFrmFieldCtrl form-control" style="width:20%;float:left;" onclick="DDLChange('FoolFrmFieldCtrl')" type="text" value="交通事业部" />
                    <div style="width:100%;float:left;margin-top:30px;">
                        <span class="FoolFrmFieldName" style="float:left;height:80px;line-height:80px;" onclick="DDLChange('FoolFrmFieldName')">请假原因</span>
                        <textarea class="form-control" style="width:90%;float:left;height:200px;"></textarea>
                    </div>

                </div>
            </div>
            <!--  表单  end  -->
        </div>

        <div style="width:18%;margin-left:2%;float:left;">
            <!-- css设计面板. -->
            <select class="ttstyle" style="width:100%;margin-bottom:10px;" id="DDL_Style" onchange="DDLChange()"></select>

            <div id="styleeditor" style="display:block;width:100%;">

                <!--<div class="ttstyle" style="background:#4e6dc3;color:#fff;margin:0;">样式编辑器</div>-->
                <div class="ttstyle">整体</div>
                <div class="styletitle">
                    背景颜色：
                    <input id="TBPara_background-color" value="" style="width:90px;" />
                </div>
                <div class="styletitle">
                    整体宽度：
                    <input class="borderwidthval" id="TBPara_selfbody-width" value="" />
                    <select id="TBPara_selfbodywidth-unit">
                        <option value="px">px</option>
                        <option value="pt">pt</option>
                        <option value="em">em</option>
                        <option value="ex">ex</option>
                        <option value="pc">pc</option>
                        <option value="cm">cm</option>
                        <option value="mm">mm</option>
                        <option value="in">in</option>
                        <option value="%">%</option>
                    </select>
                </div>
                <div class="styletitle">
                    整体高度：
                    <input class="borderwidthval" id="TBPara_selfbody-hight" value="" />
                    <select id="TBPara_selfbodyhight-unit">
                        <option value="px">px</option>
                        <option value="pt">pt</option>
                        <option value="em">em</option>
                        <option value="ex">ex</option>
                        <option value="pc">pc</option>
                        <option value="cm">cm</option>
                        <option value="mm">mm</option>
                        <option value="in">in</option>
                        <option value="%">%</option>
                    </select>
                </div>
                <div class="ttstyle" style="margin-top:25px;">字体</div>
                <div class="styletitle">
                    字体大小：
                    <input class="borderwidthval" id="TBPara_font-size" value="" />
                    <select id="TBPara_fontsize-unit">
                        <option value="px">px</option>
                        <option value="pt">pt</option>
                        <option value="em">em</option>
                        <option value="ex">ex</option>
                        <option value="pc">pc</option>
                        <option value="cm">cm</option>
                        <option value="mm">mm</option>
                        <option value="in">in</option>
                        <option value="%">%</option>
                    </select>
                </div>
                <div class="styletitle">
                    字体粗细：
                    <select id="TBPara_font-weight">
                        <option value="normal">正常</option>
                        <option value="bold">加粗</option>
                    </select>
                </div>
                <div class="styletitle">
                    字体样式：
                    <select id="TBPara_font-style">
                        <option value="normal">正常</option>
                        <option value="italic">斜体</option>
                    </select>
                </div>
                <div class="styletitle">
                    字体行高：
                    <input class="borderwidthval" id="TBPara_font-height" value="" />
                    <select id="TBPara_fontheight-unit">
                        <option value="px">px</option>
                        <option value="pt">pt</option>
                        <option value="em">em</option>
                        <option value="ex">ex</option>
                        <option value="pc">pc</option>
                        <option value="cm">cm</option>
                        <option value="mm">mm</option>
                        <option value="in">in</option>
                        <option value="%">%</option>
                    </select>
                </div>
                <div class="styletitle">
                    字体款式：
                    <select id="TBPara_font-family">
                        <option value="SimSun">宋体</option>
                        <option value="SimHei">黑体</option>
                        <option value="Microsoft YaHei">微软雅黑</option>
                        <option value="Microsoft JhengHei">微软正黑体</option>
                        <option value="NSimSun">新宋体</option>
                        <option value="PMingLiU">新细明体</option>
                        <option value="MingLiU">细明体</option>
                        <option value="DFKai-SB">标楷体</option>
                        <option value="FangSong">仿宋</option>
                        <option value="KaiTi">楷体</option>
                    </select>
                </div>
                <div class="styletitle">
                    字体颜色：
                    <input id="TBPara_font-color" value="" style="width:90px;" />
                </div>
                <div class="ttstyle">
                    边框：
                    <select id="TBPara_border-which" style="float:right;height:33px;line-height:33px;border:none;">
                        <option value="all" selected>全部</option>
                        <option value="top">上</option>
                        <option value="bottom">下</option>
                        <option value="left">左</option>
                        <option value="right">右</option>
                    </select>
                </div>
                <div class="styletitle">
                    边框宽度：
                    <input class="borderwidthval" type="text" id="TBPara_border-width" value="" />
                    <select id="TBPara_borderwidth-unit">
                        <option value="px">px</option>
                        <option value="pt">pt</option>
                        <option value="em">em</option>
                        <option value="ex">ex</option>
                        <option value="pc">pc</option>
                        <option value="cm">cm</option>
                        <option value="mm">mm</option>
                        <option value="in">in</option>
                        <option value="%">%</option>
                    </select>
                </div>
                <div class="styletitle">
                    边框颜色： <input id="TBPara_border-color" value="" style="width:90px;" />
                </div>
                <div class="styletitle">
                    边框样式：
                    <select id="DDLPara_border-style">
                        <option value="none">无</option>
                        <option value="solid">实线</option>
                        <option value="double">双线</option>
                        <option value="groove">3D凹槽</option>
                        <option value="ridge">3D垄状</option>
                        <option value="dashed">虚线</option>
                        <option value="dotted">点状</option>
                    </select>
                </div>
            </div>

            <input type="button" id="Btn_SaveItem" onclick="SaveItem()" value="保存" />

            <!--<button id="Btn_SaveItem"  class="btn btn-primary" onclick="SaveItem()" style="width:100%;margin-top:20px;">保存</button>-->


        </div>
    </div>
    <style>
        .ttstyle {
            border: 1px solid rgba(0,0,0,.125);
            height: 35px;
            line-height: 35px;
            background: #d6e0fb;
            padding-left: 5px;
            margin-bottom: 20px;
        }

        .toprightbutton {
            float: right;
            margin-right: 20px;
            margin-top: 15px;
        }

        .FoolHeader span {
            color: #fff;
        }

        .FoolFrmTable {
            min-width: 545px;
            width: 100%;
            background: #dbe1f9;
            padding-top: 0px;
            padding-bottom: 20px;
            float: left;
        }

        textarea {
            height: 120px;
            width: 98%;
        }

        td {
            line-height: 32px;
        }

        body {
            margin: 0;
            padding: 0;
        }

        .FoolHeader {
            width: 100%;
            background: #4e6dc3;
            height: 60px;
            line-height: 60px;
            text-align: center;
        }

        .borderwidthval {
            width: 40px;
        }

        .styletitle {
            width: 100%;
            height: 35px;
        }

        .FoolFrmTitleLable {
            text-align: center;
            display: block;
            float: right;
            height: 60px;
            line-height: 60px;
            margin-right: 20px;
        }

        .tbody {
            width: 100%;
        }

        .FoolFrmFieldTR {
            float: left;
            background: #dbe1f9;
            width: 100%;
            padding: 20px;
        }

        .FoolFrmGroupBar {
            display: block;
            width: 100%;
            float: left;
            padding: 0;
            margin: 0;
            height: 40px;
            line-height: 40px;
            text-indent: 20px
        }

        .FoolFrmFieldName {
            float: left;
            height: 35px;
            line-height: 35px;
            width: 6%;
        }





        .FoolFrmTitleTH {
            width: 100%;
            text-align: center;
            float: left;
            height: 60px;
            border: 1px solid #dbe1f9;
            background: #fff;
        }

        .FoolFrmTitleIcon {
            float: left;
            height: 58px;
        }
    </style>
    <script>

        $(function () {

            //背景色控件
            $("#TBPara_background-color").colorpicker({

                fillcolor: true,

                success: function (o, color) {
                    var changeobj = $('#DDL_Style').val();//要改变的对象
                    if (changeobj) {//判断是否有选中对象
                        $("." + changeobj).css("backgroundColor", color);
                    } else {
                        return false;
                    }
                }

            });
            //字体颜色控件
            $("#TBPara_font-color").colorpicker({

                fillcolor: true,

                success: function (o, color) {
                    var changeobj = $('#DDL_Style').val();//要改变的对象
                    if (changeobj) {//判断是否有选中对象
                        $("." + changeobj).css("color", color);
                    } else {
                        return false;
                    }
                }

            });

            //边框颜色控件
            $("#TBPara_border-color").colorpicker({

                fillcolor: true,

                success: function (o, color) {
                    var changeobj = $('#DDL_Style').val();//要改变的对象
                    var borderselect = $('#TBPara_border-which').val();
                    if (changeobj) {//判断是否有选中对象
                        if (borderselect == 'all') {
                            $("." + changeobj).css("borderColor", color);
                        } else {
                            $("." + changeobj).css("border-" + borderselect + "-color", color);
                        }

                    } else {
                        return false;
                    }
                }

            });


        })



        // var thisproperty = $(this).attr('id').substring(7);//当前属性
        //文字大小
        $("#TBPara_font-size").keyup(function () {
            var changeobj = $('#DDL_Style').val();//要改变的对象
            var thispropertyval = $("#TBPara_font-size").val();//文字大小的值
            if (changeobj) {//判断是否有选中对象
                $("." + changeobj).css("fontSize", thispropertyval + $("#TBPara_fontsize-unit").val());
            } else {
                return false;
            }
        })

        $("#TBPara_fontsize-unit").change(function () {
            var changeobj = $('#DDL_Style').val();//要改变的对象
            var thispropertyval = $("#TBPara_font-size").val();//文字大小的值
            if (changeobj) {//判断是否有选中对象
                $("." + changeobj).css("fontSize", thispropertyval + $("#TBPara_fontsize-unit").val());
            } else {
                return false;
            }
        })
        //整体宽度
        $("#TBPara_selfbody-width").keyup(function () {
            var changeobj = $('#DDL_Style').val();//要改变的对象
            var thispropertyval = $("#TBPara_selfbody-width").val();//文字大小的值
            if (changeobj) {//判断是否有选中对象
                $("." + changeobj).css("width", thispropertyval + $("#TBPara_selfbodywidth-unit").val());
            } else {
                return false;
            }
        })

        $("#TBPara_selfbodywidth-unit").change(function () {
            var changeobj = $('#DDL_Style').val();//要改变的对象
            var thispropertyval = $("#TBPara_font-size").val();//文字大小的值
            if (changeobj) {//判断是否有选中对象
                $("." + changeobj).css("width", thispropertyval + $("#TBPara_selfbodywidth-unit").val());
            } else {
                return false;
            }
        })
        //整体高度
        $("#TBPara_selfbody-hight").keyup(function () {
            var changeobj = $('#DDL_Style').val();//要改变的对象
            var thispropertyval = $("#TBPara_selfbody-hight").val();//文字大小的值
            if (changeobj) {//判断是否有选中对象
                $("." + changeobj).css("height", thispropertyval + $("#TBPara_selfbodyhight-unit").val());
            } else {
                return false;
            }
        })

        $("#TBPara_selfbodyhight-unit").change(function () {
            var changeobj = $('#DDL_Style').val();//要改变的对象
            var thispropertyval = $("#TBPara_selfbody-hight").val();//文字大小的值
            if (changeobj) { //判断是否有选中对象
                $("." + changeobj).css("height", thispropertyval + $("#TBPara_selfbodyhight-unit").val());
            } else {
                return false;
            }
        })
        //字体粗细
        $("#TBPara_font-weight").change(function () {
            var changeobj = $('#DDL_Style').val();//要改变的对象
            var thispropertyval = $("#TBPara_font-weight").val();//文字大小的值
            if (changeobj) {
                $("." + changeobj).css("fontWeight", thispropertyval);
            } else {
                return false;
            }
        })
        //字体样式
        $("#TBPara_font-style").change(function () {
            var changeobj = $('#DDL_Style').val();
            var thispropertyval = $("#TBPara_font-style").val();
            if (changeobj) {
                $("." + changeobj).css("fontStyle", thispropertyval);
            } else {
                return false;
            }
        })
        //字体行高
        $("#TBPara_font-height").keyup(function () {
            var changeobj = $('#DDL_Style').val();
            var thispropertyval = $("#TBPara_font-height").val();

            if (changeobj) {
                $("." + changeobj).css("line-height", thispropertyval + $("#TBPara_fontheight-unit").val());
            } else {
                return false;
            }
        })

        $("#TBPara_fontheight-unit").change(function () {
            var changeobj = $('#DDL_Style').val();
            var thispropertyval = $("#TBPara_font-height").val();
            if (changeobj) {
                $("." + changeobj).css("lineHeight", thispropertyval + $("#TBPara_fontheight-unit").val());
            } else {
                return false;
            }
        })

        //字体款式
        $("#TBPara_font-family").change(function () {
            var changeobj = $('#DDL_Style').val();
            var thispropertyval = $("#TBPara_font-family").val();
            if (changeobj) {
                $("." + changeobj).css("fontFamily", thispropertyval);
            } else {
                return false;
            }
        })

        //边框宽度
        $("#TBPara_border-width").keyup(function () {
            var changeobj = $('#DDL_Style').val();
            var thispropertyval = $("#TBPara_border-width").val();
            var borderselect = $('#TBPara_border-which').val();
            if (changeobj) {
                if (borderselect == "all") {
                    $("." + changeobj).css("borderWidth", thispropertyval + $("#TBPara_borderwidth-unit").val());
                } else {
                    $("." + changeobj).css("border-" + borderselect + "-width", thispropertyval + $("#TBPara_borderwidth-unit").val());
                }

            } else {
                return false;
            }
        })

        $("#TBPara_borderwidth-unit").change(function () {
            var changeobj = $('#DDL_Style').val();
            var thispropertyval = $("#TBPara_border-width").val();
            var borderselect = $('#TBPara_border-which').val();
            if (changeobj) {
                if (borderselect == "all") {
                    $("." + changeobj).css("borderWidth", thispropertyval + $("#TBPara_borderwidth-unit").val());
                } else {
                    $("." + changeobj).css("border-" + borderselect + "-width", thispropertyval + $("#TBPara_borderwidth-unit").val());
                }
            } else {
                return false;
            }
        })

        //边框样式
        $("#DDLPara_border-style").change(function () {
            var changeobj = $('#DDL_Style').val();
            var thispropertyval = $("#DDLPara_border-style").val();
            if (changeobj) {
                console.log(thispropertyval);
                $("." + changeobj).css("borderStyle", thispropertyval);
            } else {
                return false;
            }
        })
    </script>
</body>
</html>