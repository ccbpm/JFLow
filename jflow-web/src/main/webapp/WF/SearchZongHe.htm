<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>æµç¨‹ç»¼åˆæŸ¥è¯¢</title>
    <script src="./Scripts/vue.js"></script>
    <!-- Element Ui -->
    <link rel="stylesheet" href="./Scripts/element/element.css" />
    <link href="Style/skin/css/style.css" rel="stylesheet" type="text/css" />
    <link href="Style/skin/css/animate.css" rel="stylesheet" type="text/css" />
    <script src="./Scripts/element/element.js"></script>
    <script type="text/javascript" src="Scripts/bootstrap/js/jquery.min.js"></script>
    <script src="Scripts/QueryString.js"></script>
    <script src="Scripts/config.js" type="text/javascript"></script>
    <script type="text/javascript" src="Comm/Gener.js"></script>
    <script type="text/javascript" src="Scripts/dayjs.min.js"></script>
    <style>
        body {
            padding: 0;
            margin: 0;
        }

        #app {
            background-color: white;
        }

        /* æ ·å¼è¦†ç›– */
        .el-table__header {
            width: 100% !important;
        }

        .el-table__body {
            width: 100% !important;
        }

        /* è‡ªå®šä¹‰ */
        .box {
            margin: 20px 10px;
        }

        .box .content {
            padding-right: 40px;
        }

        .f-left {
            float: left;
        }

        .title {
            line-height: 40px;
        }

        .search-box {
            margin: 15px 0;
        }
    </style>
</head>

<body class="gray-bg">
<div id="app" class="wrapper wrapper-content animated fadeInRight">
    <div class="box ibox-content">
        <div>
            <div class="f-left title">å…³é”®å­—ï¼š</div>
            <div class="f-left content">
                <el-input v-model="keyWord" placeholder="è¯·è¾“å…¥å†…å®¹"></el-input>
            </div>
        </div>
        <div>
            <div class="f-left title">æ—¥æœŸä»ï¼š</div>
            <div class="f-left content">
                <el-date-picker v-model="date" type="daterange" range-separator="è‡³" start-placeholder="å¼€å§‹æ—¥æœŸ"
                                end-placeholder="ç»“æŸæ—¥æœŸ" value-format="yyyy-MM-dd">
                </el-date-picker>
            </div>
        </div>
        <div>
            <div class="f-left title">çŠ¶æ€ï¼š</div>
            <div class="f-left content">
                <el-select v-model="status" placeholder="è¯·é€‰æ‹©">
                    <el-option v-for="item in statusOpt" :key="item.value" :label="item.label" :value="item.value">
                    </el-option>
                </el-select>
            </div>
        </div>
        <div>
            <el-button type="primary" icon="el-icon-search" @click="onSearch">æœç´¢</el-button>
        </div>
    </div>
    <el-table :data="tableData" border=border style="width: 100%;">
        <el-table-column prop="no" label="åºå·" type="index" />
        </el-table-column>
        <el-table-column prop="Title" label="æ ‡é¢˜" />
        </el-table-column>
        <el-table-column prop="flow" label="æµç¨‹/åœç•™èŠ‚ç‚¹" />
        </el-table-column>
        <el-table-column prop="StarterName" label="å‘èµ·äºº" />
        </el-table-column>
        <el-table-column prop="initiateDate" label="å‘èµ·æ—¥æœŸ" />
        </el-table-column>
        <el-table-column prop="lastDate" label="æœ€åæ—¥æœŸ" />
        </el-table-column>
        <!--<el-table-column prop="time" label="è€—æ—¶" />
        </el-table-column>-->
        <el-table-column prop="status" label="çŠ¶æ€" />
        </el-table-column>
    </el-table>
</div>
</body>
<script type="text/javascript">
    new Vue({
        el: '#app',
        data: function () {
            return {
                tableData: [
                    {
                        Title: 'æ ‡é¢˜',
                        flow: 'æµç¨‹/åœç•™èŠ‚ç‚¹',
                        StarterName: 'å‘èµ·äºº',
                        initiateDate: 'å‘èµ·æ—¥æœŸ',
                        lastDate: 'æœ€åæ—¥æœŸ',
                        //time: 'è€—æ—¶',
                        status: 'çŠ¶æ€'
                    }
                ],
                statusOpt: [{
                    value: 'all',
                    label: 'å…¨éƒ¨'
                }, {
                    value: '2',
                    label: 'è¿è¡Œä¸­'
                }, {
                    value: '5',
                    label: 'é€€å›'
                }, {
                    value: '3',
                    label: 'å·²å®Œæˆ'
                }],
                status: 'all',
                date: '', // elementç”¨æˆ·ç‚¹å‡»æ¸…é™¤ä¼šç½®ä¸ºnull
                keyWord: ''
            }
        },
        methods: {
            onSearch: function () {
                this.search(
                    this.keyWord,
                    this.date ? this.date[0] + ' 00:00:00' : '',
                    this.date ? this.date[1] + ' 23:59:59' : '',
                    "",
                    this.status
                );
            },
            search: function (
                Key = "",
                DTFrom = "",
                DTTo = "",
                FlowNo = "",
                WFState = ""
            ) {
                //æ‰§è¡ŒæŸ¥è¯¢.
                const handler = new HttpHandler("BP.WF.HttpHandler.WF");
                handler.AddPara("Key", Key);
                handler.AddPara("DTFrom", DTFrom);
                handler.AddPara("DTTo", DTTo);
                handler.AddPara("FlowNo", FlowNo);
                handler.AddPara("WFState", WFState);
                const data = handler.DoMethodReturnJSON("SearchZongHe_Init");
                console.log(`ğŸš€ :: data`, data);
                this.handleData(data);
            },
            handleData: function (data) {
                const now = dayjs();
                this.tableData = data.map(item => {
                    item.flow = `${item.FlowName}/${item.NodeName}`;
                    item.initiateDate = item.RDT.substring(0, 16);
                    item.lastDate = item.SendDT.substring(0, 16);
                    // è€—æ—¶ å·²å®Œæˆ æŒ‰ç…§ RDT , Send DTä¸¤ä¸ªæ—¶é—´å·®è®¡ç®—
                    let diffm;
                    if (item.WFState == 3) {
                        diffm = dayjs(item.SendDT).diff(dayjs(item.RDT));
                    } else {
                        //diffm = dayjs.duration(dayjs().diff(dayjs(item.RDT)))
                    }
                    // const dayObj = dayjs.duration(diffm).$d.$ds;
                    //item.time = `${dayObj.days}å¤©${dayObj.hours}æ—¶${dayObj.minutes}åˆ†`
                    /*
                        dayjs diff
                        now > SendDT æ­£
                        now < SendDT è´Ÿ
                    */
                    if (item.WFState == 2) {
                        item.status = now.diff(dayjs(item.SDTOfNode)) <= 0 ? 'è¿è¡Œä¸­' : 'å·²é€¾æœŸ';
                    } else if (item.WFState == 3) {
                        item.status = 'å·²å®Œæˆ'
                    } else if (item.WFState == 5) {
                        item.status = 'é€€å›'
                    } else {
                        item.status = 'å…¶ä»–'
                    }

                    return item;
                })
                console.log(`ğŸš€ :: this.tableData`, this.tableData);
            }
        },
        created() {
            // dayjs.extend(dayjs_plugin_duration);
        },
        mounted() {
            this.search();
        }
    })
</script>

</html>